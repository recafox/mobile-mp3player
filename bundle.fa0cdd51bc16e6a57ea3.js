(()=>{"use strict";var t={682:(t,e,r)=>{const n=function(t){return document.querySelector(t)};function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}const a=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.container=n,this.lyricMap=this.parseLyric(e),this.lyricsWrapper=Array.from(n.children).filter((function(t){return t.className.includes("js-lyrics-wrapper")}))[0],this.lyricsList=Array.from(this.lyricsWrapper.children).filter((function(t){return t.className.includes("js-lyrics-list")}))[0],this.titleNode=Array.from(n.children).filter((function(t){return t.className.includes("js-lyrics-title")}))[0],this.allSentences=null,this.intervalId=void 0,this.currentTime=0,this.isCounting=!1,this.currentPlaying="",this.activeClassName="is--current",this.offset=45,this.lyricsList.style.top="0px",this.reset(),this.setTitle(r),this.render()}var e,r;return e=t,(r=[{key:"parseLyric",value:function(t){for(var e=t.split(""),r=0,n=e.length,i=void 0,a={},s=!0;r<=n;){if("["===e[r-1]?(s=!0,i=""):"]"===e[r]&&(s=!1,a[i=Math.floor(this.convertToMilliSec(i))]=""),!0===s&&(i+="".concat(e[r])),!1===s&&"["!==e[r]&&"]"!==e[r]&&e[r]){var c="".concat(e[r]);a[i]+=c}r++}return a}},{key:"convertToMilliSec",value:function(t){return 100*parseInt(t.split(":")[0],10)*60+100*parseFloat(t.split(":")[1])}},{key:"render",value:function(){var t=this,e="";for(var r in t.lyricMap)e+=t.createLyricTmpl(t.lyricMap[r],r);t.lyricsList.innerHTML=e,t.allSentences=Array.from(t.lyricsList.querySelectorAll("p"))}},{key:"createLyricTmpl",value:function(t,e){return'<p data-time="'.concat(e,'">').concat(t,"</p>")}},{key:"start",value:function(t){var e=this;e.isCounting=!0,t>0&&(e.clear(),e.updateCurrent(e.getNearest(100*t.toFixed(2)))),e.currentTime=100*t.toFixed(2),e.intervalId=window.setInterval((function(){for(var t in e.currentTime++,e.lyricMap)Math.ceil(t)===e.currentTime&&(e.clear(),e.updateCurrent(e.currentTime))}),10)}},{key:"getNearest",value:function(t){var e=[];for(var r in this.lyricMap)e.push(r);e.push(t);var n=e.sort((function(t,e){return t-e}));return n[n.indexOf(t)-1]}},{key:"stop",value:function(){this.isCounting=!1,window.clearInterval(this.intervalId)}},{key:"updateCurrent",value:function(t){var e=this,r=e.allSentences.find((function(e){return parseInt(e.dataset.time)===parseInt(t)}));if(r){r.classList.add(e.activeClassName);var n=e.allSentences.findIndex((function(e){return parseInt(e.dataset.time)===parseInt(t)})),i=r.getBoundingClientRect().top,a=window.innerHeight;if(e.lyricsList.style.top="-".concat(e.offset*n,"px"),i>a/3){if(n>e.allSentences.length-3)return;var s=isNaN(parseInt(e.lyricsList.style.top.replace("px","").trim(),10))?0:parseInt(e.lyricsList.style.top.replace("px","").trim(),10);e.lyricsList.style.top="".concat(s-e.offset,"px")}}}},{key:"clear",value:function(){var t=this,e=t.allSentences.find((function(e){return e.classList.contains(t.activeClassName)}));e&&e.classList.remove(t.activeClassName)}},{key:"removeAll",value:function(){this.lyricsList.innerHTML=""}},{key:"reset",value:function(){this.titleNode.innerText="",this.lyricsList.innerHTML=""}},{key:"setTitle",value:function(t){this.titleNode.innerText=t}}])&&i(e.prototype,r),t}();function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function c(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}const o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.isPlaying=!1,this.currentTrack=null,this.audioEl=new Audio,this.progressTimer=null,this.playBtn=n(".js-start-btn"),this.prevBtn=n(".js-prev-btn"),this.nextBtn=n(".js-next-btn"),this.loopBtn=n(".js-loop-btn"),this.repeatBtn=n(".js-repeat-btn"),this.randomBtn=n(".js-random-btn"),this.progressBar=n(".js-progress-bar"),this.playerBg=n(".js-player-bg"),this.cover=n(".js-cover"),this.trackTitle=n(".js-song-title"),this.artistName=n(".js-artist-name"),this.listPage=n(".js-track-list"),this.prompter=null}var e,r;return e=t,(r=[{key:"setTrack",value:function(t){this.currentTrack=this.getTrack(t),this.audioEl.src=this.currentTrack.path,this.audioEl.currentTime=0,this.updateProgressBar(),this.stopTrack(),this.setCoverArt(this.currentTrack),this.setTrackInfo(this.currentTrack),this.setCurrentItem(t),this.prompter=new a(this.currentTrack.lyrics,this.currentTrack.name,n(".js-lyrics-container"))}},{key:"playTrack",value:function(){var t=this;t.isPlaying=!0,t.audioEl.play(),Array.from(t.playBtn.childNodes).filter((function(t){return"IMG"===t.tagName}))[0].src="./assets/icon/ic_pause.png",t.updateProgressBar(),t.prompter&&t.prompter.start(t.audioEl.currentTime)}},{key:"playNext",value:function(){var t=this;t.setTrack(function(){for(var e=0;e<t.currentPlaylist.length;e++)if(t.currentPlaylist[e].id===t.currentTrack.id)return void 0!==t.currentPlaylist[e+1]?t.currentPlaylist[e+1].id:t.currentPlaylist[0].id}()),t.playTrack()}},{key:"playPrev",value:function(){var t=this;t.setTrack(function(){for(var e=0;e<t.currentPlaylist.length;e++)if(t.currentPlaylist[e].id===t.currentTrack.id)return void 0!==t.currentPlaylist[e-1]?t.currentPlaylist[e-1].id:t.currentPlaylist[t.currentPlaylist.length-1].id}()),t.playTrack()}},{key:"setTrackCurrentTime",value:function(t){var e=this;e.stopTrack(),e.audioEl.currentTime=t,e.playTrack()}},{key:"updateProgressBar",value:function(){var t=this,e=Array.from(t.progressBar.childNodes).filter((function(t){return void 0!==t.classList&&t.classList.contains("js-bar")}))[0];t.progressTimer=setInterval((function(){e.setAttribute("style","width:".concat(t.calculateProgressBar(t.audioEl.currentTime,t.audioEl.duration),"%"))}),500)}},{key:"calculateProgressBar",value:function(t,e){return t/e*100}},{key:"stopProgressBar",value:function(){window.clearInterval(this.progressTimer)}},{key:"stopTrack",value:function(){var t=this;t.isPlaying=!1,Array.from(t.playBtn.childNodes).filter((function(t){return"IMG"===t.tagName}))[0].src="./assets/icon/ic_play.png",t.audioEl.pause(),t.stopProgressBar(),t.prompter&&t.prompter.stop()}},{key:"getTrackCurrentTime",value:function(){return this.audioEl.currentTime}},{key:"getTrackDuration",value:function(){return this.audioEl.duration}},{key:"getTrack",value:function(t){return this.playlist.find((function(e){return parseInt(e.id)===parseInt(t)}))}},{key:"setCoverArt",value:function(t){this.cover.src=t.art,this.playerBg.setAttribute("src",t.art)}},{key:"setTrackInfo",value:function(t){this.trackTitle.innerText=t.name,this.artistName.innerText=t.artist}},{key:"createList",value:function(){var t=this,e="";this.playlist.forEach((function(r){e+=t.createListItem(r)})),this.listPage.innerHTML=e}},{key:"createListItem",value:function(t){return'<li class="list__item" data-id="'.concat(t.id,'">\n          <div class="item__content">\n            <h3>').concat(t.name,"</h3>\n            <p>").concat(t.artist,"</p>\n          </div>\n        </li>")}},{key:"setCurrentItem",value:function(t){var e=Array.from(document.querySelectorAll(".list__item"));e.forEach((function(t){t.classList.remove("is--current")})),e.find((function(e){return parseInt(e.dataset.id)===parseInt(t)})).classList.add("is--current")}},{key:"setPlayMode",value:function(t){var e=this;switch(t){case"loop":e.currentPlaylist=e.loopList;break;case"random":e.currentPlaylist=e.shuffleArray(e.playlist);break;case"repeatOne":e.currentPlaylist=[e.currentTrack]}}},{key:"shuffleArray",value:function(t){for(var e,r=JSON.parse(JSON.stringify(t)),n=r.length;n;){n--,e=Math.floor(Math.random()*n);var i=r[n];r[n]=r[e],r[e]=i}return r}},{key:"initialize",value:function(t){var e,r=this;r.playlist=t.sort((function(t,e){return t.id-e.id})),r.repeatOneList=[r.currentTrack],r.loopList=function(t){if(Array.isArray(t))return s(t)}(e=r.playlist)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(e)||function(t,e){if(t){if("string"==typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(t,e):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),r.createList(),r.setPlayMode("loop"),r.setTrack(r.currentPlaylist[0].id),r.audioEl.currentTime=0,r.updateProgressBar(),r.playBtn.addEventListener("click",(function(t){r.isPlaying?r.stopTrack():r.playTrack()})),r.menuToggle=n(".js-menu-btn"),r.container=n(".js-container"),r.container.addEventListener("click",(function(t){var e="current--".concat(t.target.dataset.to),r=n(".js-container");void 0!==t.target.dataset.to&&(["player","lyric","list"].forEach((function(t){r.classList.remove("current--".concat(t))})),r.classList.add(e))})),r.listPage.addEventListener("click",(function(t){var e=t.target.closest(".list__item");r.setTrack(e.dataset.id)})),r.progressBar.addEventListener("mousedown",(function(t){var e=r.progressBar.offsetWidth,n=t.offsetX/e*r.audioEl.duration;r.setTrackCurrentTime(n),r.updateProgressBar()}));var i=Array.from(document.querySelectorAll(".js-mode-btn"));i.forEach((function(t){t.addEventListener("click",(function(e){i.forEach((function(t){t.classList.remove("is--current")})),t.classList.add("is--current"),r.setPlayMode(this.dataset.playmode)}))})),r.nextBtn.addEventListener("click",(function(t){r.playNext()})),r.prevBtn.addEventListener("click",(function(t){r.playPrev()})),r.audioEl.addEventListener("ended",(function(){r.prompter.removeAll(),r.playNext()}))}}])&&c(e.prototype,r),t}();r(433);document.querySelectorAll(".js-action").forEach((function(t){t.addEventListener("click",(function(t){(function(t,e){return Array.from(t.children).filter((function(t){return t.className.includes(e)}))[0]}(this,"js-action-img")).src="./assets/icon/".concat(this.getAttribute("data-actionImg"),".png")}))})),fetch("./assets/songs.json").then((function(t){return t.json()})).then((function(t){var e=new o;window.setTimeout((function(){e.initialize(t)}),1e3)}))},433:(t,e,r)=>{r.r(e),r.d(e,{default:()=>n});const n=r.p+"/css/style.css"}},e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.p="",r(682),r(433)})();